Please see hvnc2/libs/libvncsrv/rfbregion.c in Carberp folder of https://github.com/ytisf/theZoo for source code. 
